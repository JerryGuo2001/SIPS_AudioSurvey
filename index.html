<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible"
		content="IE=edge">
	<meta name="viewport"
		content="width=device-width, initial-scale=1.0">
	<title>
		SIS Audio Survey
	</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js/dist/umd/supabase.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.1.0/dist/umd/supabase.js"></script>
</head>
	<script>
        localStorage.clear()
        testAudio = []
		audioList = []
        SubID = []
        demographics = []
        // audio is true, for recording
        const audioIN = { audio: true}
        // Access the permission for use
        // the microphone
        navigator.mediaDevices.getUserMedia(audioIN)

        // 'then()' method returns a Promise
        .then(function (mediaStreamObj) {

            // Connect the media stream to the
            // first audio element
            let audio = document.querySelector('audio');
            //returns the recorded audio via 'audio' tag

            // 'srcObject' is a property which 
            // takes the media object
            // This is supported in the newer browsers
            if ("srcObject" in audio) {
            audio.srcObject = mediaStreamObj;
            }
            else { // Old version
            audio.src = window.URL
                .createObjectURL(mediaStreamObj);
            }

            // It will play the audio
            // audio.onloadedmetadata = function (ev) {

            // // Play the audio in the 2nd audio
            // // element what is being recorded
            // audio.play();
            // };

            // Start record
            let start = document.getElementById(`btnStart-test`);

            // Stop record
            let stop = document.getElementById(`btnStop-test`);

            // 2nd audio tag for play the audio
            let playAudio = document.getElementById(`audioPlay-test`);

            // This is the main thing to recorded 
            // the audio 'MediaRecorder' API
            let mediaRecorder = new MediaRecorder(mediaStreamObj);
            // Pass the audio stream 

            // Start event
            start.addEventListener('click', function (ev) {
            mediaRecorder.start();
            // console.log(mediaRecorder.state);
            })

            // Stop event
            stop.addEventListener('click', function (ev) {
            mediaRecorder.stop();
            // console.log(mediaRecorder.state);
            });

            // If audio data available then push 
            // it to the chunk array
            mediaRecorder.ondataavailable = function (ev) {
            dataArray.push(ev.data);
            }

            // Chunk array to store the audio data 
            let dataArray = [];

            // Convert the audio data in to blob 
            // after stopping the recording
            mediaRecorder.onstop = function (ev) {

                // blob of type mp3
                let audioData = new Blob(dataArray, 
                            { 'type': 'audio/mp3;' });
                
                // After fill up the chunk 
                // array make it empty
                dataArray = [];

                // Creating audio url with reference 
                // of created blob named 'audioData'
                let audioSrc = window.URL
                    .createObjectURL(audioData);

                // Pushing the audio file to an array outside function
                testAudio.push(audioData)
                

                // Pass the audio url to the 2nd video tag
                playAudio.src = audioSrc;
            }
        })
        // If any error occurs then handles the error 
        .catch(function (err) {
            console.log(err.name, err.message);
        });

	</script>
	<style>
		/* Styling the Body element 
		i.e. Color, Font, Alignment */
		body {
			background-color: #002244;
			font-family: Verdana;
			text-align: center;
		}

		/* Styling the Form (Color, Padding, Shadow) */
		form {
			background-color: #fff;
			max-width: 1000px;
			margin: 50px auto;
			padding: 30px 20px;
			box-shadow: 2px 5px 10px rgba(0, 0, 0, 0.5);
		}

		/* Styling form-control Class */
		.form-control {
			text-align: left;
			margin-bottom: 25px;
		}

		/* Styling form-control Label */
		.form-control label {
			display: block;
			margin-bottom: 10px;
		}

		/* Styling form-control input, 
		select, textarea */
		.form-control input,
		.form-control select,
		.form-control textarea {
			border: 1px solid #777;
			border-radius: 2px;
			font-family: inherit;
			padding: 10px;
			display: block;
			width: 95%;
		}

		/* Styling form-control Radio 
		button and Checkbox */
		.form-control input[type="radio"],
		.form-control input[type="checkbox"] {
			display: inline-block;
			width: auto;
		}

        .tab{
            display:none
        }

		/* Styling Button */
		#nextBtn {
			background-color: #05c46b;
			border: none;
			border-radius: 5px;
			font-family: inherit;
			font-size: 21px;
			display: block;
			width: 30%;
			margin-top: 50px;
			margin-bottom: 20px;
            margin-right: 30px;
            float: right;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.2s;
		}

        #checkBtn {
			background-color: #4258c7;
			border: none;
			border-radius: 5px;
			font-family: inherit;
			font-size: 21px;
			display: block;
			width: 30%;
			margin-top: 50px;
			margin-bottom: 20px;
            margin-left: 20px;
            float: left;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.2s;
		}
        #nextBtn:hover, #checkBtn:hover {
            transform: scale(1.05);
        }

        /* Active/Pressed effect for buttons */
        #nextBtn:active, #checkBtn:active {
            transform: scale(0.95);
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
        }

       .Next {
            display: block
        }

        .ThankYou {
            display: none
        }

		.PositiveChoice {
			display: none
		}

		.NegativeChoice {
			display: none
		}

        .Start {
            display: block;
        }

        .Stop {
            display: block;
        }
        
        [id^="btnStart-"], [id^="btnStop-"] {
            padding: 10px 20px; 
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
            transition: background-color 0.3s, transform 0.2s;
        }

        [id^="btnStart-"] {
            background-color: #06b563;
            color: black;
        }

        [id^="btnStop-"] {
            background-color: rgb(247, 76, 76);
            color: black;
        }

        /* Hover effect for buttons */
        [id^="btnStart-"]:hover, [id^="btnStop-"]:hover {
            transform: scale(1.05);
        }

        /* Active/Pressed effect for buttons */
        [id^="btnStart-"]:active, [id^="btnStop-"]:active {
            transform: scale(0.95);
            box-shadow: 0px 2px 4px rgba(0, 0, 0, 0.2);
        }
        #loadData {
            background-color: #d3d3d3; /* Muted color */
            color: #333; /* Dark text color */
            border: none; /* Remove default border */
            padding: 10px 20px; /* Add padding */
            border-radius: 5px; /* Rounded corners */
            font-size: 16px; /* Font size */
            cursor: pointer; /* Pointer cursor on hover */
            transition: background-color 0.3s, color 0.3s; /* Smooth transition */
        }

        #loadData.clicked {
            background-color: #4CAF50; /* Green color when clicked */
            color: white; /* White text color when clicked */
        }
	</style>
</head>

<body>
    <script>
        
        const supabaseUrl = 'https://pxjzoermcszmmxyuuqbp.supabase.co'; // Replace with your Supabase URL
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB4anpvZXJtY3N6bW14eXV1cWJwIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcyNDEzMTAzNiwiZXhwIjoyMDM5NzA3MDM2fQ.C7lKr43mhydm0gEX1X6v7RI-wn2-D7k_Vh98Q89-hSA'; // Replace with your Supabase anon/public key
        const supabase1 = supabase.createClient(supabaseUrl, supabaseKey); 

             // Example: Save data to Supabase
             async function saveData(id, dem, slider, audio) {
            const { data, error } = await supabase1
                .from('data_store')
                .insert([{ id: id, demographics: dem, slider_values: slider, audio_data_1: audio[0], audio_data_2: audio[1], audio_data_3: audio[2], audio_data_4: audio[3]
                    , audio_data_5: audio[4], audio_data_6: audio[5], audio_data_7: audio[6], audio_data_8: audio[7], audio_data_9: audio[8], audio_data_10: audio[9], audio_data_11: audio[10]
                    , audio_data_12: audio[11], audio_data_13: audio[12], audio_data_14: audio[13], audio_data_15: audio[14], audio_data_16: audio[15], audio_data_17: audio[16], audio_data_18: audio[17],
                    audio_data_19: audio[18], audio_data_20: audio[19], audio_data_21: audio[20], audio_data_22: audio[21], audio_data_23: audio[22], audio_data_24: audio[23]
                 }]);

            if (error) {
                console.error('Error saving data:', error);
            } else {
                console.log('Data saved:', data);
            }
        }

        function dataLoader() {
            var AudioString = JSON.stringify(base64Audio);
            // localStorage.setItem("AudioFiles", AudioString)
            // localStorage.setItem("CombinedResponses", JSON.stringify(JSON.parse(localStorage.Demographics).concat(JSON.parse(localStorage.SliderValues),JSON.parse(localStorage.AudioFiles))))
            // Example code to send data to Vercel API
            let id = demographics[0]
            let dem = [demographics[1],demographics[2],demographics[3]]
            let slider = JSON.parse(localStorage.SliderValues)
            let audio = base64Audio
            saveData(id,dem,slider,audio)
            var button = document.getElementById('loadData');
            button.textContent = 'Data saved!';
            button.classList.add('clicked');
        }
    </script>
	<form id="form">
        <div class = "tab"><h1>SIS Audio</h1>
            <div class="form-control">
                <label for="Prolific" id="label-Prolific" >
                    Prolific ID <sup>*</sup>
                </label>
                <input type="text" id="ProlificIDvalue"
                    placeholder="Experimenter: enter your Prolific ID" />
                </input>
            </div>
            <div class = "form-control">
                <label for="Age" id="label-Age" value = Age>
                    Age <sup>*</sup>
                </label>
                <input type="text" id="Agevalue"
                    placeholder="Enter your age" />
                </input>
            </div>
            <div class="form-control">
                <label for="gender" id="label-gender">
                    Gender <sup>*</sup>
                </label>
                <!-- Dropdown options -->
                <select name="gender" id="gender">
                    <option value="Gender" disabled selected>Enter your gender</option>
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Non-binary">Non-binary</option>
                    <option value="Genderfluid">Genderfluid</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-control">
                <label for="role" id="label-role">
                    Education Level? <sup>*</sup>
                </label>
                <!-- Dropdown options -->
                <select name="role" id="role">
                    <option value="Role" disabled selected>Enter your highest completed education</option>
                    <option value="No Highschool Degree">No Highschool Degree</option>
                    <option value="Associates Degree">Associates Degree</option>
                    <option value="Some college">Some college</option>
                    <option value="College Degree">College Degree</option>
                    <option value="Graduate Degree">Graduate Degree</option>
                </select>
            </div>
            <span style="display: inline; margin-left: 70%;"><small>* indicates a required question</small></span>
        </div>

        <div class = "tab">
            <div class = "audioTest">
                <header>
                    <h1>SIS Audio Check</h1><p>This is a test to see if your audio is properly working. After stopping the recording, press the check button to ensure your data will be properly saved. </p> </n> <p>You will have as much time as you require to say as much as you can about the questions. Please make sure to speak in as much detail as you can about the topic.</p><hr />
                </header>
                
                <h3>What did you eat for breakfast this morning?</h3>
                <!--button for 'start recording'-->
                <p>
                    <button type="button" name="startTest" id="btnStart-test" onclick="RecordingButtonStartTest()">START RECORDING</button>
                        &nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="button" name="stopTest" id="btnStop-test" onclick="RecordingButtonStopTest()">STOP RECORDING</button>
                    <!--button for 'stop recording'-->
                </p>

                <!--for record (Can change but this one has no play button so it just auto records)-->
                <audio autoplay controls muted = 'true' style="display:none;"></audio>
                <!--'controls' use for add 
                    play, pause, and volume-->

                <!--for play the audio-->
                <audio id="audioPlay-test" controls></audio>
            </div>
        </div>

		<!-- Question 1 start -->
        <div class = "Questions" id="AQ">
        </div>
		<!-- Question 1 end -->

        <p id="recordingStatus" style="color: red; display: none; font-weight: bold;  font-family: 'Courier New', Courier, 'Lucida Console', monospace; font-size: 18px; letter-spacing: 1px; margin-left: 30px;">Recording...</p>

		<div class = "tab">
            <h1> Thank you for your participation!</h1>
            <h3>Click the button below to finish the survey </h3>
            <div class = "end" style="display:block">
                <button type="button" id="loadData" value="load" onclick="dataLoader()">Save Data</button>
            </div>
        </div>

        <div class = "Next" style = "overflow:auto;" style = "float:right;">
            <button type="button" id="nextBtn" value="next" onclick="nextPrev()">
                Next
            </button>
            <button type="button" id="checkBtn" value="check" style="display:none" onclick="CheckAudio()">
                Check
            </button>
        </div>
		<!-- This is the HTML for the button ; the nextPrev() is the function called in the script -->
        
        

    </div>
	</form>

    <script>
        const SurveyQuestions = [
            //Non-Alcohol Questions
            "What is a significant memory from your childhood that you still vividly remember?",
            "What is a recent memory that stands out to you, and why does it feel significant?",
            //Alcohol Questions
            "Can you tell me about the first time you tried alcohol? How old were you, how did it make you feel?",
            "Are there any experiences you had when drinking that really stand out? Can you tell me about one or two of them, in detail?",
            "You’ve described some experiences. Are they good examples of how you feel about drinking right now, or at this point in your life?",
            "Can you describe how your thinking about drinking has changed over the years?"
        ]
        SurveyQuestions.forEach(function(question, index) {
            
            var value = 4*index
            var questionHTML = 
                `<div class = "tab">
                    <div class = "introQ">
                        <header>
                            <h1>SIS Audio Questions</h1><p>You will have as much time as you require to say as much as you can about the questions. Please make sure to speak in as much detail as you can about the topic.</p><hr />
                        </header>

                        
                        
                        <h3>${question}</h3>
                        <div class = "divider" style = "display:none">
                            <hr />
                        </div>
                        <!--button for 'start recording'-->
                        <p class = "introspace" style="display:block">
                            <button type="button" name="start" id="btnStart-${value}" onclick="RecordingButtonStart(${value})">START RECORDING</button>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="button" name="stop" id="btnStop-${value}" onclick="RecordingButtonStop1(${value},${index})">STOP RECORDING</button>
                            <!--button for 'stop recording'-->
                        </p>

                        <!--for record (Can change but this one has no play button so it just auto records)-->
                        <audio autoplay controls muted = 'true' style="display:none;"></audio>
                        <!--'controls' use for add 
                            play, pause, and volume-->

                        <!--for play the audio-->
                        <audio id="audioPlay-${value}" ></audio>
                    </div>

                    <div class = "confirm1" style ="display:none;">
                        <h3>Just to confirm, when exactly did the experience happen?</h3>
                        <!--button for 'start recording'-->
                        <p>
                            <button type="button" name="start" id="btnStart-${value+1}" onclick="RecordingButtonStart(${value+1})">START RECORDING</button>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="button" name="stop" id="btnStop-${value+1}" onclick="RecordingButtonStop2(${value+1},${index})">STOP RECORDING</button>
                            <!--button for 'stop recording'-->
                        </p>

                        <!--for record-->
                        <audio autoplay controls muted = 'true' style="display:none;"></audio>
                        <audio id="audioPlay-${value+1}" ></audio>
                    </div>

                    <div class = "rate1" style = "display:none">
                        <div class="form-control">
                            <div style='text-align: center; position: relative;'>
                                <label for='scaleSlider'><h3>Rate this experience on a scale of strongly negative to strongly positive</h3></label>
                                <br>
                                <input type='range' id='scaleSlider-${index*2}' name='scaleSlider' style='width: 900px;' min='1' max='7' step='1' value='1' oninput='updateValue(this.value,${index*2})'>
                                <div style='position: relative; width: 900px; margin-top: 10px;'>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 2%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 19%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 35%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 52%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 68%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 85%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 102%;'></div>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 0%;'>Strongly Negative</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 17%;'>Negative</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 33%;'>Somewhat Negative</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 50%;'>Neutral</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 66%;'>Somewhat Positive</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 83%;'>Positive</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 100%;'>Strongly Positive</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class = "posnegexpo1" style = "display:none">
                        <p class="posnegline" style="padding-bottom: 20px;"></p><hr /><h3>If your memory was <u>positive</u>, try telling me something <i>negative</i>. If your memory was <u>negative</u>, try recalling a <i>positive</i> one. If it is a <u>neutral</u> experience tell another <i>related story</i>.</h3>
                        <!--button for 'start recording'-->
                        <p>
                            <button type="button" name="start" id="btnStart-${value+2}" onclick="RecordingButtonStart(${value+2})">START RECORDING</button>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="button" name="stop" id="btnStop-${value+2}" onclick="RecordingButtonStop3(${value+2},${index})">STOP RECORDING</button>
                            <!--button for 'stop recording'-->
                        </p>

                        <!--for record-->
                        <audio autoplay controls muted = 'true' style="display:none;"></audio>
                        <!--'controls' use for add 
                            play, pause, and volume-->

                        <!--for play the audio-->
                        <audio id="audioPlay-${value+2}" ></audio>
                    </div>

                    <div class = "rate2" style = "display:none">
                        <div class="form-control">
                            <div style='text-align: center; position: relative;'>
                                <label for='scaleSlider'><h3>Rate this experience on a scale of strongly negative to strongly positive</h3></label>
                                <br>
                                <input type='range' id='scaleSlider-${index*2+1}' name='scaleSlider' style='width: 900px;' min='1' max='7' step='1' value='1' oninput='updateValue(this.value,${index*2+1})'>
                                <div style='position: relative; width: 900px; margin-top: 10px;'>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 4%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 19%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 35%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 52%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 68%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 85%;'></div>
                                    <div style='position: absolute; width: 1px; height: 20px; background-color: black; top: -5px; left: 102%;'></div>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 0%;'>Strongly Negative</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 17%;'>Negative</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 33%;'>Somewhat Negative</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 50%;'>Neutral</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 66%;'>Somewhat Positive</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 83%;'>Positive</span>
                                    <span style='position: absolute; width: 5px; font-size: 12px; top: 20px; left: 100%;'>Strongly Positive</span>
                                    &nbsp;&nbsp;&nbsp;&nbsp;
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class = "confirm2" style = "display:none">
                        <p style="padding-bottom: 20px;"></p><hr /><h3>Just to confirm, when exactly did the experience happen?</h3>
                        <!--button for 'start recording'-->
                        <p>
                            <button type="button" name="start" id="btnStart-${value+3}" onclick="RecordingButtonStart(${value+3})">START RECORDING</button>
                                &nbsp;&nbsp;&nbsp;&nbsp;
                            <button type="button" name="stop" id="btnStop-${value+3}" onclick="RecordingButtonStop4(${value+3},${index})">STOP RECORDING</button>
                            <!--button for 'stop recording'-->
                        </p>

                        <!--for record-->
                        <audio autoplay controls muted = 'true' style="display:none;"></audio>
                        <audio id="audioPlay-${value+3}" ></audio>
                    </div>
                </div>
            `;
            document.getElementById('AQ').innerHTML += questionHTML;
        })
    </script>
	<script>
		// Set current tab to keep track of where the user is
		var currentTab = 0

        
		// Function that is identified below ; called to show present tab
		showTab(currentTab);

        if (currentTab == 0){
            alert("Please ensure you accept audio permissions before continuing the survey, it might take a couple seconds to appear.");
        }

        function RecordingButtonStartTest() {
            document.getElementById(`btnStart-test`).style.display = 'none'
            document.getElementById('recordingStatus').style.display = 'inline';
        }

        function RecordingButtonStopTest() {
            if (document.getElementById(`btnStart-test`).style.display == 'none'){
                document.getElementById(`btnStop-test`).style.display = 'none'
                document.getElementById('recordingStatus').style.display = 'none';
                document.getElementById("checkBtn").style.display = "block";
            }
        }

        function CheckAudio() {
            if (testAudio[0].type.includes("audio/mp3;")) {
                document.getElementById("nextBtn").style.display = "block";
            } else {
                document.getElementById("nextBtn").style.display = "none";
                alert("Unfortunately your audio does not seem to be working");
                var allTabs = document.getElementsByClassName('tab')
                allTabs[1].style.display = "none"
                allTabs[allTabs.length-1].style.display = "block"
                document.getElementById("checkBtn").style.display = "none";
            }
        }

        function blobToBase64(blob, callback) {
                    const reader = new FileReader();
                    reader.onloadend = function() {
                        callback(reader.result);
                    };
                    reader.readAsDataURL(blob);
                }

        function RecordingButtonStart(value) {
            document.getElementById(`btnStart-${value}`).style.display = 'none'
            document.getElementById('recordingStatus').style.display = 'inline';
        }

        function RecordingButtonStop1(value, index) {
            if (document.getElementById(`btnStart-${value}`).style.display == 'none'){
                for(let i = 0;i<(4*SurveyQuestions.length);i++){
                    // // audio is true, for recording

                    // // Access the permission for use
                    // // the microphone
                    navigator.mediaDevices.getUserMedia({audio:true})

                    // 'then()' method returns a Promise
                    .then(function (mediaStreamObj) {

                        // Connect the media stream to the
                        // first audio element
                        let audio = document.querySelector('audio');
                        //returns the recorded audio via 'audio' tag

                        // 'srcObject' is a property which 
                        // takes the media object
                        // This is supported in the newer browsers
                        if ("srcObject" in audio) {
                        audio.srcObject = mediaStreamObj;
                        }
                        else { // Old version
                        audio.src = window.URL
                            .createObjectURL(mediaStreamObj);
                        }

                        // It will play the audio
                        // audio.onloadedmetadata = function (ev) {

                        // // Play the audio in the 2nd audio
                        // // element what is being recorded
                        // audio.play();
                        // };

                        // Start record
                        let start = document.getElementById(`btnStart-${i}`);

                        // Stop record
                        let stop = document.getElementById(`btnStop-${i}`);

                        // 2nd audio tag for play the audio
                        let playAudio = document.getElementById(`audioPlay-${i}`);

                        // This is the main thing to recorded 
                        // the audio 'MediaRecorder' API
                        let mediaRecorder = new MediaRecorder(mediaStreamObj);
                        // Pass the audio stream 

                        // Start event
                        start.addEventListener('click', function (ev) {
                        mediaRecorder.start();
                        // console.log(mediaRecorder.state);
                        })

                        // Stop event
                        stop.addEventListener('click', function (ev) {
                        mediaRecorder.stop();
                        // console.log(mediaRecorder.state);
                        });

                        // If audio data available then push 
                        // it to the chunk array
                        mediaRecorder.ondataavailable = function (ev) {
                        dataArray.push(ev.data);
                        }

                        // Chunk array to store the audio data 
                        let dataArray = [];

                        // Convert the audio data in to blob 
                        // after stopping the recording
                        mediaRecorder.onstop = function (ev) {

                            // blob of type mp3
                            let audioData = new Blob(dataArray, 
                                        { 'type': 'audio/mp3;' });
                            
                            // After fill up the chunk 
                            // array make it empty
                            dataArray = [];

                            // Creating audio url with reference 
                            // of created blob named 'audioData'
                            let audioSrc = window.URL
                                .createObjectURL(audioData);

                            // Pushing the audio file to an array outside function
                            if(audioList[i]){
                            }else{audioList.push(audioData)}

                            // Pass the audio url to the 2nd video tag
                            playAudio.src = audioSrc;
                        }
                    })
                }			
                document.getElementById(`btnStop-${value}`).style.display = 'none'
                document.getElementById('recordingStatus').style.display = 'none';
                document.getElementsByClassName("divider")[index].style.display="block";
                document.getElementsByClassName("confirm1")[index].style.display="block";
                document.getElementsByClassName("introspace")[index].style.display="none";
            }
        }

        function RecordingButtonStop2(value, index) {
            if (document.getElementById(`btnStart-${value}`).style.display == 'none'){
                document.getElementById(`btnStop-${value}`).style.display = 'none'
                document.getElementById('recordingStatus').style.display = 'none';
                document.getElementsByClassName("confirm1")[index].style.display="none";
                document.getElementsByClassName("rate1")[index].style.display="block";
            }
        }

        function RecordingButtonStop3(value, index) {
            if (document.getElementById(`btnStart-${value}`).style.display == 'none'){
                document.getElementById(`btnStop-${value}`).style.display = 'none'
                document.getElementById('recordingStatus').style.display = 'none';
                document.getElementsByClassName("divider")[index].style.display="none";
                
                document.getElementsByClassName("posnegline")[index].style.paddingBottom="0px";
                document.getElementsByClassName("rate1")[index].style.display="none";
                document.getElementsByClassName("rate2")[index].style.display="block";
            }
        }

        function RecordingButtonStop4(value, index) {
            if (document.getElementById(`btnStart-${value}`).style.display == 'none'){
                document.getElementById(`btnStop-${value}`).style.display = 'none'
                document.getElementById('recordingStatus').style.display = 'none';
                document.getElementById("nextBtn").style.display="block" 
            }
        }

		function showTab(n) {
			var x = document.getElementsByClassName("tab")
			x[0].style.display = "block"
		}

        var base64Audio = []

		function nextPrev() {
            document.getElementById("checkBtn").style.display = "none";
            // audio is true, for recording

            // Access the permission for use
            // the microphone
            navigator.mediaDevices.getUserMedia(audioIN)

            // 'then()' method returns a Promise
            .then(function (mediaStreamObj) {

                // Connect the media stream to the
                // first audio element
                let audio = document.querySelector('audio');
                //returns the recorded audio via 'audio' tag

                // 'srcObject' is a property which 
                // takes the media object
                // This is supported in the newer browsers
                if ("srcObject" in audio) {
                audio.srcObject = mediaStreamObj;
                }
                else { // Old version
                audio.src = window.URL
                    .createObjectURL(mediaStreamObj);
                }

                // It will play the audio
                // audio.onloadedmetadata = function (ev) {

                // // Play the audio in the 2nd audio
                // // element what is being recorded
                // audio.play();
                // };

                // Start record
                let start = document.getElementById(`btnStart-0`);

                // Stop record
                let stop = document.getElementById(`btnStop-0`);

                // 2nd audio tag for play the audio
                let playAudio = document.getElementById(`audioPlay-0`);

                // This is the main thing to recorded 
                // the audio 'MediaRecorder' API
                let mediaRecorder = new MediaRecorder(mediaStreamObj);
                // Pass the audio stream 

                // Start event
                start.addEventListener('click', function (ev) {
                mediaRecorder.start();
                // console.log(mediaRecorder.state);
                })

                // Stop event
                stop.addEventListener('click', function (ev) {
                mediaRecorder.stop();
                // console.log(mediaRecorder.state);
                });

                // If audio data available then push 
                // it to the chunk array
                mediaRecorder.ondataavailable = function (ev) {
                dataArray.push(ev.data);
                }

                // Chunk array to store the audio data 
                let dataArray = [];

                // Convert the audio data in to blob 
                // after stopping the recording
                mediaRecorder.onstop = function (ev) {

                    // blob of type mp3
                    let audioData = new Blob(dataArray, 
                                { 'type': 'audio/mp3;' });
                    
                    // After fill up the chunk 
                    // array make it empty
                    dataArray = [];

                    // Creating audio url with reference 
                    // of created blob named 'audioData'
                    let audioSrc = window.URL
                        .createObjectURL(audioData);

                    // Pushing the audio file to an array outside function
                    audioList.push(audioData)
                    

                    // Pass the audio url to the 2nd video tag
                    playAudio.src = audioSrc;
                }
            })
            // If any error occurs then handles the error 
            .catch(function (err) {
                console.log(err.name, err.message);
            });

            var x = document.getElementsByClassName("tab");
			// Remove current tab when calling next
			x[currentTab].style.display = "none";
			currentTab += 1
			x[currentTab].style.display = "block"
			window.scrollTo(0,0)
			if (currentTab == x.length - 1){
				document.getElementById("nextBtn").style.display="none"
                demographics = [document.getElementById("ProlificIDvalue").value, document.getElementById("Agevalue").value, Gendervalue, Rolevalue]

                for (let i=0;i<(4*SurveyQuestions.length);i++){
                    blobToBase64(audioList[i], function(base64) {
                        base64Audio[i] = base64
                    });
                }
                var sliderValue = []
                for (let i = 0;i<document.getElementsByName('scaleSlider').length;i++) {
                    sliderValue[i] = document.getElementsByName('scaleSlider')[i].value
                }

                var DemographicsString = JSON.stringify(demographics)
                var sliderValueString = JSON.stringify(sliderValue)


                localStorage.setItem("Demographics", DemographicsString)
                localStorage.setItem("SliderValues",sliderValueString)
            }
            document.getElementById("nextBtn").style.display="none" 
        }

        // const button = document.getElementById('myButton');

        // function handleClick(event) {
        //     event.stopPropagation();
        //     event.preventDefault();

        //     console.log('Button clicked');
        //     // Your code here
        // }

        // button.addEventListener('click', handleClick);


    

        function showNextButton() {
            document.getElementsByClassName('Next')[0].style.display = 'block';
        }

        let sliderValueVariable = 0;
        function updateValue(value,scaledIndex) {
            sliderValueVariable = value;
            document.getElementById(`scaleSlider-${scaledIndex}`).textContent = value;
            if (scaledIndex % 2 == 0){
                var index = scaledIndex/2
                document.getElementsByClassName('posnegexpo1')[index].style.display = 'block';
            }else {
                var index = (scaledIndex - 1)/2
                document.getElementsByClassName('confirm2')[index].style.display = 'block';
                
            }
        }

	</script>
    <script>
        document.getElementById('gender').addEventListener('change', function() {
            Gendervalue = this.value;
            if (document.getElementById("ProlificIDvalue").value != "" && document.getElementById("Agevalue").value != "" &&  document.getElementById('gender').value != 'Gender' && document.getElementById('role').value != 'Role'){
                document.getElementById("nextBtn").style.display = "block"
            }
        });
        document.getElementById('role').addEventListener('change', function() {
            Rolevalue = this.value;
            if (document.getElementById("ProlificIDvalue").value != "" && document.getElementById("Agevalue").value != "" &&  document.getElementById('gender').value != 'Gender' && document.getElementById('role').value != 'Role'){
                document.getElementById("nextBtn").style.display = "block"
            }
        });

        document.getElementById('ProlificIDvalue').addEventListener('change', function() {
            if (document.getElementById("ProlificIDvalue").value != "" && document.getElementById("Agevalue").value != "" &&  document.getElementById('gender').value != 'Gender' && document.getElementById('role').value != 'Role'){
                document.getElementById("nextBtn").style.display = "block"
            }
        });

        document.getElementById('Agevalue').addEventListener('change', function() {
            if (document.getElementById("ProlificIDvalue").value != "" && document.getElementById("Agevalue").value != "" &&  document.getElementById('gender').value != 'Gender' && document.getElementById('role').value != 'Role'){
                document.getElementById("nextBtn").style.display = "block"
            }
        });

        function data(){
            demographics = [document.getElementById('ProlificIDvalue'), document.getElementById("Agevalue").value, Gendervalue, Rolevalue]
        }
        if (currentTab ==0){
            document.getElementById("nextBtn").style.display = "none"
        }
        


    </script>

    <script>
        

    </script>
</body>

</html>
